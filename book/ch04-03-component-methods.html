<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Component Methods - The PLCnext Runtime</title>
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
        <link rel="stylesheet" href="theme/first-edition.css">
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "light" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div id="sidebar-scrollbox" class="sidebar-scrollbox">
                <ol class="chapter"><li class="expanded affix "><a href="title-page.html">The PLCnext Runtime</a></li><li class="expanded affix "><a href="edition-notice.html">Copyright Notice</a></li><li class="expanded affix "><a href="acknowledgments.html">Acknowledgments</a></li><li class="expanded affix "><a href="ch00-00-introduction.html">Introduction</a></li><li class="expanded "><a href="ch01-00-getting-started.html"><strong aria-hidden="true">1.</strong> Getting Started</a></li><li><ol class="section"><li class="expanded "><a href="ch01-01-ip-address.html"><strong aria-hidden="true">1.1.</strong> Setting the IP Address</a></li><li class="expanded "><a href="ch01-02-shell-session.html"><strong aria-hidden="true">1.2.</strong> Starting a Shell Session</a></li><li class="expanded "><a href="ch01-03-hello-world.html"><strong aria-hidden="true">1.3.</strong> Hello, World!</a></li><li class="expanded "><a href="ch01-04-installing-a-software-development-kit.html"><strong aria-hidden="true">1.4.</strong> Installing a Software Development Kit</a></li><li class="expanded "><a href="ch01-05-hello-again-world.html"><strong aria-hidden="true">1.5.</strong> Hello Again, World!</a></li></ol></li><li class="expanded "><a href="ch02-00-operating-system.html"><strong aria-hidden="true">2.</strong> Operating System</a></li><li><ol class="section"><li class="expanded "><a href="ch02-01-security.html"><strong aria-hidden="true">2.1.</strong> Security</a></li><li class="expanded "><a href="ch02-02-users-and-privileges.html"><strong aria-hidden="true">2.2.</strong> Users and Privileges</a></li><li class="expanded "><a href="ch02-03-setting-the-time.html"><strong aria-hidden="true">2.3.</strong> Setting the Time</a></li><li class="expanded "><a href="ch02-04-firmware.html"><strong aria-hidden="true">2.4.</strong> Firmware</a></li><li class="expanded "><a href="ch02-05-disk-partitions.html"><strong aria-hidden="true">2.5.</strong> Disk Partitions</a></li><li class="expanded "><a href="ch02-06-file-system.html"><strong aria-hidden="true">2.6.</strong> File System</a></li><li class="expanded "><a href="ch02-07-installing-software.html"><strong aria-hidden="true">2.7.</strong> Installing Software</a></li></ol></li><li class="expanded "><a href="ch03-00-plcnext-runtime.html"><strong aria-hidden="true">3.</strong> PLCnext Runtime</a></li><li><ol class="section"><li class="expanded "><a href="ch03-01-controlling-the-plcnext-runtime.html"><strong aria-hidden="true">3.1.</strong> Controlling the PLCnext Runtime</a></li><li class="expanded "><a href="ch03-02-diagnosing-problems.html"><strong aria-hidden="true">3.2.</strong> Diagnosing Problems</a></li><li class="expanded "><a href="ch03-03-plcnext-runtime-components.html"><strong aria-hidden="true">3.3.</strong> PLCnext Runtime Components</a></li><li class="expanded "><a href="ch03-04-component-instances.html"><strong aria-hidden="true">3.4.</strong> Component Instances</a></li><li class="expanded "><a href="ch03-05-disabling-features.html"><strong aria-hidden="true">3.5.</strong> Disabling Features</a></li><li class="expanded "><a href="ch03-06-rsc-services.html"><strong aria-hidden="true">3.6.</strong> RSC Services</a></li></ol></li><li class="expanded "><a href="ch04-00-extension-components.html"><strong aria-hidden="true">4.</strong> Extension Components</a></li><li><ol class="section"><li class="expanded "><a href="ch04-01-simple-component.html"><strong aria-hidden="true">4.1.</strong> Simple Extension Component</a></li><li class="expanded "><a href="ch04-02-library-singleton.html"><strong aria-hidden="true">4.2.</strong> Component Library Singleton</a></li><li class="expanded "><a href="ch04-03-component-methods.html" class="active"><strong aria-hidden="true">4.3.</strong> Component Methods</a></li><li class="expanded "><a href="ch04-04-using-rsc-services.html"><strong aria-hidden="true">4.4.</strong> Using RSC Services</a></li><li class="expanded "><a href="ch04-05-worker-threads.html"><strong aria-hidden="true">4.5.</strong> Worker Threads</a></li><li class="expanded "><a href="ch04-06-creating-gds-variables-1.html"><strong aria-hidden="true">4.6.</strong> Creating GDS variables - Part 1</a></li><li class="expanded "><a href="ch04-07-plcnext-cli.html"><strong aria-hidden="true">4.7.</strong> PLCnext CLI</a></li><li class="expanded "><a href="ch04-08-creating-gds-variables-2.html"><strong aria-hidden="true">4.8.</strong> Creating GDS variables - Part 2</a></li><li class="expanded "><a href="ch04-09-connecting-gds-variables.html"><strong aria-hidden="true">4.9.</strong> Connecting GDS Variables</a></li><li class="expanded "><a href="ch04-10-interactive-course.html"><strong aria-hidden="true">4.10.</strong> Interactive Course</a></li></ol></li><li class="expanded "><a href="ch05-00-real-time-programming.html"><strong aria-hidden="true">5.</strong> Real Time Programming</a></li><li><ol class="section"><li class="expanded "><a href="ch05-01-cpp-programs.html"><strong aria-hidden="true">5.1.</strong> C++ Programs</a></li><li class="expanded "><a href="ch05-02-real-time-guidelines.html"><strong aria-hidden="true">5.2.</strong> Real-time C++ Programming Guidelines</a></li><li class="expanded "><a href="ch05-03-building-and-deploying.html"><strong aria-hidden="true">5.3.</strong> Building and Deploying a Real-time C++ Application</a></li><li class="expanded "><a href="ch05-04-iec-programs.html"><strong aria-hidden="true">5.4.</strong> IEC 61131-3 Programs</a></li></ol></li><li class="expanded "><a href="ch06-00-configuring-io.html"><strong aria-hidden="true">6.</strong> Configuring I/O</a></li><li class="expanded "><a href="ch07-00-other-tools.html"><strong aria-hidden="true">7.</strong> Other Programming Tools</a></li><li class="expanded "><a href="ch08-00-extension-processes.html"><strong aria-hidden="true">8.</strong> Extension Processes</a></li><li class="expanded "><a href="ch09-00-what-next.html"><strong aria-hidden="true">9.</strong> What Next</a></li><li><ol class="section"><li class="expanded "><a href="ch09-01-the-big-picture.html"><strong aria-hidden="true">9.1.</strong> The Big Picture</a></li><li class="expanded "><a href="ch09-02-get-involved.html"><strong aria-hidden="true">9.2.</strong> Get Involved!</a></li></ol></li><li class="expanded "><a href="appendix-00.html"><strong aria-hidden="true">10.</strong> Appendix</a></li><li><ol class="section"><li class="expanded "><a href="appendix-01-programming-resources.html"><strong aria-hidden="true">10.1.</strong> A - Programming Resources</a></li><li class="expanded "><a href="appendix-02-list-of-rsc-services.html"><strong aria-hidden="true">10.2.</strong> B - RSC Services</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">The PLCnext Runtime</h1>

                        <div class="right-buttons">
                            <a href="print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                            
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h2><a class="header" href="#component-methods" id="component-methods">Component Methods</a></h2>
<p>After completing the previous sections, an instance of your PLCnext extension component - called <code>MyComponentInstance</code> - has been created by the PLCnext runtime. At the moment, this component instance is not doing much. The PLCnext runtime has called a number of the methods that you defined in the <code>MyComponent</code> class, but because these methods are empty, we don't see any evidence that this has happened. Let's write some messages to the <code>Output.log</code> file, so we can see when these methods are called.</p>
<p>One way that our component instance can write to the Output.log file is if it inherits a base class created from the template <a href="https://api.plcnext.help/api_docs_2021-0-LTS/classArp_1_1System_1_1Commons_1_1Diagnostics_1_1Logging_1_1Loggable_3_01Derived_00_01true_01_4.html"><code>Arp::System::Commons::Diagnostics::Logging::Loggable</code></a>.</p>
<p>The main steps to do this are:</p>
<ul>
<li>
<p>Add the header file to the .hpp file of our component:</p>
<pre><code class="language-cpp">#include &quot;Arp/System/Commons/Logging.h&quot;
</code></pre>
</li>
<li>
<p>Inherit the <code>Loggable</code> template class, by adding the following to the component class definition:</p>
<pre><code class="language-cpp">private Loggable&lt;MyComponent&gt;
</code></pre>
<p>The component class thereby inherits a private field - called <code>log</code> - of type <a href="https://api.plcnext.help/api_docs_2021-0-LTS/classArp_1_1System_1_1Commons_1_1Diagnostics_1_1Logging_1_1Log.html">Arp::System::Commons::Diagnostics::Logging::Log</a>.</p>
</li>
<li>
<p>Add log messages where required.</p>
<p>In this case, we have added a log message to every method in the component's <code>.cpp</code> file. The resulting source files are available here:</p>
<ul>
<li><a href="samples/ch04-03-component-methods/MyProject/src/MyComponent.hpp">MyComponent.hpp</a></li>
<li><a href="samples/ch04-03-component-methods/MyProject/src/MyComponent.cpp">MyComponent.cpp</a></li>
</ul>
<p>You can use these files to update the project you created in the previous section.</p>
</li>
<li>
<p>Rebuild the project.</p>
</li>
<li>
<p>Copy the resulting library file to the target.</p>
</li>
<li>
<p>Restart the PLCnext runtime:</p>
<pre><code class="language-text"># sudo /etc/init.d/plcnext restart &amp;&amp; tail -f -n 0 /opt/plcnext/logs/Output.log
</code></pre>
</li>
</ul>
<p>Among the messages that appear in the Output.log file, you should see the following:</p>
<pre><code class="language-text">INFO  - MyComponent::Initialize
INFO  - MyComponent::SubscribeServices
INFO  - MyComponent::LoadSettings - settings path = ''
INFO  - MyComponent::SetupSettings
INFO  - MyComponent::PublishServices
INFO  - MyComponent::LoadConfig
INFO  - MyComponent::SetupConfig
</code></pre>
<p>These methods are called, in sequence, when the component instance is created by the PLCnext runtime. Other methods are called when the PLCnext runtime shuts down, just before the component instance is destroyed. Some types of components even have methods that are called during normal PLCnext runtime operation, under certain circumstances. For example, it is possible for a component to be notified when the PLC component - which executes deterministic, real-time tasks - stops and restarts.</p>
<p>Each of these methods allows the component to perform one or more common functions, if required, at the appropriate time. For example, the <code>SubscribeServices</code> method, as the name suggests, is a good place for the component to subscribe to any RSC services that it needs to use.</p>
<p>The table below shows when <code>ComponentBase</code> methods are called on ACF components. It is based on a <a href="https://www.plcnext.help/te/Programming/Cpp/Cpp_program_structure/PLM_Program_Library_Manager.htm">similar table in the PLCnext Info Center</a>.</p>
<table><thead><tr><th align="left">Method</th><th align="left">Called on an ACF component â€¦</th></tr></thead><tbody>
<tr><td align="left">Initialize<br/>SubscribeServices<br/>LoadSettings<br/>SetupSettings<br/>PublishServices</td><td align="left">During the first stage of ACF startup *</td></tr>
<tr><td align="left">LoadConfig<br/>SetupConfig<br/></td><td align="left">During the second stage of ACF startup *</td></tr>
<tr><td align="left">ResetConfig</td><td align="left">During the first stage of ACF shutdown</td></tr>
<tr><td align="left">Dispose</td><td align="left">During the second stage of ACF shutdown</td></tr>
<tr><td align="left">PowerDown</td><td align="left">Only when an unexpected power loss occurs,<br/>and only on devices that have a power status sensor</td></tr>
</tbody></table>
<p>In the above table, all the methods listed in the sections marked with * are called one after the other on each component instance in the order listed, so in practice it makes no difference in which of these method(s) the user chooses to implement their application-specific code.</p>
<p>You can see that only one of the standard component methods has a parameter. The <code>const String&amp;</code> parameter on the <code>LoadSettings</code> method allows this method to receive a string value. This parameter is generally used by firmware components to get the path to a settings file - hence the parameter name. However, you can use this parameter to pass <em>any</em> string information to your component instance during startup:</p>
<ul>
<li>
<p>In the <code>.acf.config</code> file, replace this line:</p>
<pre><code class="language-xml">  &lt;Component name=&quot;MyComponentInstance&quot; type=&quot;MyNamespace::MyComponent&quot; library=&quot;MyProject&quot; process=&quot;MyProcess&quot; /&gt;
</code></pre>
<p>... with these lines:</p>
<pre><code class="language-xml">  &lt;Component name=&quot;MyComponentInstance&quot; type=&quot;MyNamespace::MyComponent&quot; library=&quot;MyProject&quot; process=&quot;MyProcess&quot;&gt;
    &lt;Settings path=&quot;Settings data&quot; /&gt;
  &lt;/Component&gt;
</code></pre>
</li>
<li>
<p>Copy the <code>.acf.config</code> file to the target, and restart the PLCnext runtime.</p>
</li>
</ul>
<p>You should now see a line in the <code>Output.log</code> file with this message:</p>
<pre><code class="language-text">INFO  - MyComponent::LoadSettings - settings path = 'Settings data'
</code></pre>
<p>Using this method, it is possible to pass user-configurable String data to the component during component startup.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="ch04-02-library-singleton.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="ch04-04-using-rsc-services.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a href="ch04-02-library-singleton.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a href="ch04-04-using-rsc-services.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        
        
        
        <script type="text/javascript">
            window.playpen_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
